setwd("E:/R Markdown")
library("plyr")
library("dplyr")
library("car")
library("ggplot2")
library("ggpmisc")
library("lattice")
library("grid")
library("reshape2")
source("functions.R")
annual.data <- read.csv("PRIMER\\raw\\annual-data_all-seasons_all-sites.csv", header = T, stringsAsFactors = F)
all.avgs <- read.csv("PRIMER\\raw\\all-data_annual-avg_all-sites.csv", header = T, stringsAsFactors = F)
spring <- read.csv("PRIMER\\raw\\all-data_spring15_all-sites.csv", header = T, stringsAsFactors = F)
annual.nona <- na.omit(annual.data)
all.avgs.nona <- na.omit(all.avgs)
annual.data <- add.age(annual.data)
annual.data$Age <- as.numeric(annual.data$Age)
melted.annual <- melt(annual.data, measure.vars = c("O2conc", "SOD", "PercentOM", "PercentInundation", "NOxFlux", "NH3Flux", "N2Flux"))
#Get rid of NA values and percent inundation (b/c that wouldn't be expected to change w age)
melted.annual <- na.omit(melted.annual)
melted.annual <- melted.annual[!melted.annual$variable == "PercentInundation", ]
#This could be a super useful figure! Shows restoration trajectory of all parameters
#Add regression lines to show various regressions (the one below is squared)
#Modify the season filter to show one season at a time; can also change the color of the pts
melted.annual %>%
filter(Season == "Summer") %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ x + I(x^2), size = 1)
View(melted.annual)
melted.annual %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T) +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
ggplot(aes(Age, value)) +
geom_point() +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(method = "lm", formula = y ~ poly(x,2), size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T) +
stat_fit_glance(method = "lm",
geom = "text",
aes(label = paste("P-value =", signif(..p.value.., digits = 4), sep = "")),
label.x.npc = "right")
melted.annual %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T) +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
filter(Season == "Summer") %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T) +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
filter(Season == "Fall") %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T) +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
filter(Season == "Fall") %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T, label.y.npc = "top") +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
filter(Season == "Fall") %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), se = F, size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T, label.y.npc = "top") +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
filter(Season == "Winter") %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), se = F, size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T, label.y.npc = "top") +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
filter(Season == "Spring") %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), se = F, size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T, label.y.npc = "top") +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
filter(Season == "Winter") %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), se = F, size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T, label.y.npc = "top") +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T) +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
filter(Season == "Winter") %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), se = F, size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T, label.y.npc = "top") +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
filter(Season == "Fall") %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), se = F, size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T, label.y.npc = "top") +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
filter(Season == "Summer") %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), se = F, size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T, label.y.npc = "top") +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T) +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
filter(Season == "Summer") %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), se = F, size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T, label.y.npc = "top") +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
filter(Season == "Fall") %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), se = F, size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T, label.y.npc = "top") +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
filter(Season == "Winter") %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), se = F, size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T, label.y.npc = "top") +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
filter(Season == "Spring") %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), se = F, size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T, label.y.npc = "top") +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
View(all.avgs.nona)
all.avgs.nona <- add.age(all.avgs.nona)
all.avgs.nona$Age <- as.numeric(all.avgs.nona$Age)
melted.avgs <- melt(all.avgs.nona, measure.vars = c("PercentC", "PercentN", "CtoN", "PercentOM", "BulkDensity", "N2Flux"))
melted.avgs %>%
ggplot(aes(Age, value)) +
geom_point() +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(method = "lm", formula = y ~ poly(x,2), size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T) +
stat_fit_glance(method = "lm",
geom = "text",
aes(label = paste("P-value =", signif(..p.value.., digits = 4), sep = "")),
label.x.npc = "right")
melted.avgs %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T) +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep = "")),
label.x.npc = "right")
melted.annual %>%
ggplot(aes(Age, value)) +
geom_point() +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(method = "lm", formula = y ~ poly(x,2), size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T) +
stat_fit_glance(method = "lm",
geom = "text",
aes(label = paste("P-value =", signif(..p.value.., digits = 4), sep = "")),
label.x.npc = "right")
melted.avgs %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T) +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep = "")),
label.x.npc = "right")
View(melted.avgs)
melted.annual %>%
filter(Season == "Spring") %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), se = F, size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T, label.y.npc = "top") +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T) +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.avgs %>%
ggplot(aes(Age, value)) +
geom_point(aes(colour = Habitat)) +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(aes(colour = Habitat), method = "lm", formula = y ~ poly(x,2), se = F, size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(colour = Habitat, label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T) +
stat_fit_glance(method = "lm",
geom = "text",
aes(colour = Habitat, label = paste("P-value =", signif(..p.value.., digits = 4), sep = "")),
label.x.npc = "right")
melted.annual %>%
ggplot(aes(Age, value)) +
geom_point() +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(method = "lm", formula = y ~ poly(x,2), size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T) +
stat_fit_glance(method = "lm",
geom = "text",
aes(label = paste("P-value =", signif(..p.value.., digits = 4), sep = "")),
label.x.npc = "right")
melted.annual %>%
filter(Season == "Spring") %>%
ggplot(aes(Age, value)) +
geom_point() +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(method = "lm", formula = y ~ poly(x,2), se = F, size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T, label.y.npc = "top") +
stat_fit_glance(method = "lm",
geom = "text",
aes(label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
melted.annual %>%
filter(Season == "Summer") %>%
ggplot(aes(Age, value)) +
geom_point() +
facet_grid(variable ~ ., scales = "free_y") +
geom_smooth(method = "lm", formula = y ~ poly(x,2), se = F, size = 1) +
stat_poly_eq(formula = y ~ poly(x,2),
aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = T, label.y.npc = "top") +
stat_fit_glance(method = "lm",
geom = "text",
aes(label = paste("P-value =", signif(..p.value.., digits = 4), sep
= "")),
label.x.npc = "right")
